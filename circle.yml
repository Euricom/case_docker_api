machine:
    services:
        - docker

dependencies:
    override:
        - docker info
        - docker build . -t registry.heroku.com/secret-anchorage-45266/web --rm=false

test:
    post:
        - docker run -d -p $PORT:$PORT example; sleep 10
        - curl --retry 10 --retry-delay 5 -v http://localhost:$PORT
        - docker save -o $CIRCLE_ARTIFACTS\example.tar example
        - docker login --email=_ --username=_ --password=$HEROKU_API_KEY registry.heroku.com
        - docker push registry.heroku.com/secret-anchorage-45266/web